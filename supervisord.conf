[supervisord]
nodaemon=true
user=root

[program:ollama]
command=/usr/local/bin/ollama serve
autostart=true
autorestart=true
priority=10
stopsignal=SIGTERM
stdout_logfile=/workspace/logs/ollama.log
stderr_logfile=/workspace/logs/ollama.err
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:openwebui]
command=/opt/venv/bin/python3 -m uvicorn open_webui.main:app --host 0.0.0.0 --port 8080
directory=/app/backend
autostart=true
autorestart=true
startsecs=15
priority=20
stopsignal=SIGTERM
stdout_logfile=/workspace/logs/openwebui.log
stderr_logfile=/workspace/logs/openwebui.err
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:comfyui]
command=/opt/venv/bin/python3 main.py --listen 0.0.0.0 --port 8188 --preview-method auto --extra-model-paths-config /etc/comfyui_model_paths.yaml
directory=/opt/ComfyUI
autostart=true
autorestart=true
startsecs=30
priority=30
stopsignal=SIGTERM
stdout_logfile=/workspace/logs/comfyui.log
stderr_logfile=/workspace/logs/comfyui.err
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:textgenui]
# --- CHANGE: This now calls the launcher script instead of server.py directly ---
command=/start_textgenui.sh
directory=/opt/text-generation-webui
autostart=true
autorestart=true
startsecs=60
priority=40
stopsignal=SIGTERM
stdout_logfile=/workspace/logs/textgenui.log
stderr_logfile=/workspace/logs/textgenui.err
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:idle_shutdown]
command=/idle_shutdown.sh
autostart=true
autorestart=true
priority=90
stdout_logfile=/workspace/logs/idle_shutdown.log
stderr_logfile=/workspace/logs/idle_shutdown.err
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=1

[program:sync_models]
# This script pulls a default model and creates symlinks for textgenui.
command=/sync_models.sh
autostart=true
autorestart=false
startsecs=5
priority=100
stdout_logfile=/workspace/logs/sync_models.log
stderr_logfile=/workspace/logs/sync_models.err
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=1
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=1
